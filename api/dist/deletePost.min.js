"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=handler;var _db=require("./utils/db"),_mongoose=_interopRequireDefault(require("mongoose")),_ably=require("./utils/ably");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var postSchema=new _mongoose.default.Schema({message:String,timestamp:Date,username:String,sessionId:String}),Post=_mongoose.default.model("Post",postSchema);function handler(t,r){var s,n,a,o,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if("DELETE"===t.method)return s=t.query.id,n=t.body,a=n.username,o=n.sessionId,e.prev=3,e.next=6,regeneratorRuntime.awrap((0,_db.connectToDatabase)());e.next=25;break;case 6:return e.next=8,regeneratorRuntime.awrap(Post.findById(s));case 8:if(u=e.sent){e.next=11;break}return e.abrupt("return",r.status(404).json({message:"Post not found"}));case 11:if(u.username!==a||u.sessionId!==o)return e.abrupt("return",r.status(403).json({message:"You can only delete your own posts"}));e.next=13;break;case 13:return e.next=15,regeneratorRuntime.awrap(Post.findByIdAndDelete(s));case 15:return e.next=17,regeneratorRuntime.awrap((0,_ably.publishToAbly)("deleteOpinion",{id:s}));case 17:r.status(200).json({message:"Post deleted successfully"}),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),r.status(500).json({message:"Error deleting post",error:e.t0.message});case 23:e.next=26;break;case 25:r.status(405).json({message:"Method Not Allowed"});case 26:case"end":return e.stop()}},null,null,[[3,20]])}
//# sourceMappingURL=deletePost.min.js.map
