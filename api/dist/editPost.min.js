"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=handler;var _db=require("./utils/db"),_mongoose=_interopRequireDefault(require("mongoose")),_ably=require("./utils/ably");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var postSchema=new _mongoose.default.Schema({message:String,timestamp:Date,username:String,sessionId:String}),Post=_mongoose.default.model("Post",postSchema);function handler(t,r){var s,a,n,o,u,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if("PUT"!==t.method){e.next=29;break}if(s=t.query.id,a=t.body,n=a.message,o=a.username,u=a.sessionId,n&&""!==n.trim()){e.next=5;break}return e.abrupt("return",r.status(400).json({message:"Message cannot be empty"}));case 5:return e.prev=5,e.next=8,regeneratorRuntime.awrap((0,_db.connectToDatabase)());case 8:return e.next=10,regeneratorRuntime.awrap(Post.findById(s));case 10:if(i=e.sent){e.next=13;break}return e.abrupt("return",r.status(404).json({message:"Post not found"}));case 13:if(i.username!==o||i.sessionId!==u)return e.abrupt("return",r.status(403).json({message:"You can only edit your own posts"}));e.next=15;break;case 15:return i.message=n,i.timestamp=new Date,e.next=19,regeneratorRuntime.awrap(i.save());case 19:return e.next=21,regeneratorRuntime.awrap((0,_ably.publishToAbly)("editOpinion",i));case 21:r.status(200).json(i),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(5),r.status(500).json({message:"Error updating post",error:e.t0});case 27:e.next=30;break;case 29:r.status(405).json({message:"Method Not Allowed"});case 30:case"end":return e.stop()}},null,null,[[5,24]])}
//# sourceMappingURL=editPost.min.js.map
